## inline test for friction, example by Louis Gagnon and Marco Morandini;
## 2018
## based on the brake example
begin: data;
	problem: initial value;
end: data;

set: const real M = 0.016; # mass of node 
set: const real v = .1; # relative sliding velocity
set: const real k = 100.; # spring stiffness
set: const real F = 4.; # normal force

begin: initial value;
	initial time: 0.;
	final time: 50;
	time step: 1.e-3;
#~ 	tolerance: 1e-6;
	tolerance: 1e-6;
	derivatives coefficient: 1E-7;
	derivatives max iterations: 10;
	derivatives tolerance: 1e-4;
	max iterations: 50;
#~ 	max iterations: 1;
	#newton raphson: modified, 1;
#~ 	newton raphson: true;
	#abort after : derivatives;
	#output: residual, jacobian, solution;
# 	output: iterations;
threads: disable;
end: initial value;

begin: control data;
	structural nodes: 3;
	rigid bodies: 1;
	joints: 7;
	
	print: description;
	output units: MKS;
	
	# default output: none;
end: control data;

begin: nodes;
	structural: 1, static,
		null,
		eye,
		null,
		null;
	structural: 2, dynamic,
		null,
		eye,
		v, 0, 0,
		null;
	structural: 3, dynamic,
		1, 0, 0,
		eye,
		v, 0, 0,
		null;
end: nodes;

scalar function: "constfriction", const, 0.3;
scalar function: "multi", multilinear,
0, 0.6,
0.1, 0.3,
1.2, 0.3,
end;

scalar function: "RHSStri", cubicspline,
0, 0.662,
0.0634, 0.661936012798294,
0.1268, 0.661744204690817,
0.1902, 0.661425035556959,
0.2536, 0.660979269820664,
0.317, 0.660407973399867,
0.3804, 0.659712509459591,
0.4438, 0.658894532992389,
0.5072, 0.657955984256287,
0.5706, 0.65689908110665,
0.634, 0.655726310264372,
0.6974, 0.654440417568514,
0.7608, 0.653044397266854,
0.8242, 0.651541480402792,
0.8876, 0.649935122361634,
0.951, 0.648228989643397,
1.0144, 0.646426945932951,
1.0778, 0.64453303754149,
1.1412, 0.642551478295989,
1.2046, 0.640486633955483,
1.268, 0.638343006234594,
1.3314, 0.636125216515877,
1.3948, 0.633837989333073,
1.4582, 0.631486135707413,
1.5216, 0.629074536418648,
1.585, 0.626608125291425,
1.6484, 0.624091872576214,
1.7118, 0.621530768501951,
1.7752, 0.618929807075201,
1.8386, 0.616293970197753,
1.902, 0.613628212171365,
1.9654, 0.610937444654708,
2.0288, 0.608226522133676,
2.0922, 0.605500227961941,
2.1556, 0.602763261024161,
2.219, 0.600020223069507,
2.2824, 0.597275606758283,
2.3458, 0.594533784459351,
2.4092, 0.591798997830918,
2.4726, 0.589075348212033,
2.536, 0.586366787846888,
2.5994, 0.583677111958766,
2.6628, 0.581009951685335,
2.7262, 0.578368767881831,
2.7896, 0.575756845793733,
2.853, 0.573177290595671,
2.9164, 0.570633023788652,
2.9798, 0.568126780443255,
3.0432, 0.565661107272193,
3.1066, 0.563238361511691,
3.17, 0.560860710587431,
3.2334, 0.558530132537376,
3.2968, 0.556248417160711,
3.3602, 0.554017167859295,
3.4236, 0.551837804135585,
3.487, 0.549711564708782,
3.5504, 0.547639511209169,
3.6138, 0.545622532409068,
3.6772, 0.543661348947685,
3.7406, 0.541756518506225,
3.804, 0.53990844138914,
3.8674, 0.538117366467075,
3.9308, 0.536383397437153,
3.9942, 0.534706499356522,
4.0576, 0.533086505405678,
4.121, 0.531523123838878,
4.1844, 0.530015945080018,
4.2478, 0.528564448923582,
4.3112, 0.527168011801729,
4.3746, 0.525825914080184,
4.438, 0.524537347347367,
4.5014, 0.523301421663085,
4.5648, 0.522117172735108,
4.6282, 0.520983568994062,
4.6916, 0.519899518539204,
4.755, 0.518863875929898,
4.8184, 0.517875448799818,
4.8818, 0.516933004273208,
4.9452, 0.516035275164767,
5.0086, 0.515180965946977,
5.072, 0.514368758470928,
5.1354, 0.513597317428838,
5.1988, 0.512865295548594,
5.2622, 0.512171338512689,
5.3256, 0.511514089595889,
5.389, 0.510892194017837,
5.4524, 0.510304303008609,
5.5158, 0.509749077586879,
5.5792, 0.509225192051978,
5.6426, 0.508731337192541,
5.706, 0.508266223215838,
5.7694, 0.507828582403077,
5.8328, 0.507417171497124,
5.8962, 0.507030773830063,
5.9596, 0.506668201198915,
6.023, 0.506328295498616,
6.0864, 0.506009930122009,
6.1498, 0.505712011137167,
6.2132, 0.505433478252813,
6.2766, 0.505173305582968,
6.34, 0.504930502222197,
6.4034, 0.504704112643018,
6.4668, 0.504493216927093,
6.5302, 0.504296930841878,
6.5936, 0.504114405774278,
6.657, 0.503944828532786,
6.7204, 0.503787421029365,
6.7838, 0.503641439852068,
6.8472, 0.503506175739152,
6.9106, 0.503380952965055,
6.974, 0.503265128648255,
7.0374, 0.503158091990638,
7.1008, 0.503059263457549,
7.1642, 0.502968093907272,
7.2276, 0.502884063678209,
7.291, 0.502806681641551,
7.3544, 0.502735484226765,
7.4178, 0.502670034426711,
7.4812, 0.502609920788743,
7.5446, 0.502554756397638,
7.608, 0.502504177855751,
7.6714, 0.50245784426531,
7.7348, 0.502415436217303,
7.7982, 0.502376654790997,
7.8616, 0.502341220567678,
7.925, 0.502308872661796,
7.9884, 0.50227936777234,
8.0518, 0.502252479256841,
8.1152, 0.502227996230111,
8.1786, 0.502205722689459,
8.242, 0.502185476667825,
8.3054, 0.50216708941599,
8.3688, 0.502150404614749,
8.4322, 0.50213527761769,
8.4956, 0.502121574724989,
8.559, 0.502109172488441,
8.6224, 0.502097957047739,
8.6858, 0.50208782349786,
8.7492, 0.502078675287264,
8.8126, 0.502070423646476,
8.876, 0.502062987046505,
8.9394, 0.502056290686446,
9.0028, 0.50205026600955,
9.0662, 0.502044850246932,
9.1296, 0.502039985988059,
9.193, 0.502035620777107,
9.2564, 0.502031706734218,
9.3198, 0.50202820020068,
9.3832, 0.502025061407027,
9.4466, 0.502022254163044,
9.51, 0.502019745568654,
9.5734, 0.502017505744675,
9.6368, 0.502015507582444,
9.7002, 0.502013726511299,
9.7636, 0.502012140282969,
9.827, 0.502010728771888,
9.8904, 0.50200947379053,
9.9538, 0.502008358918847,
10.0172, 0.502007369346959,
10.0806, 0.502006491730228,
10.144, 0.502005714055943,
10.2074, 0.502005025520819,
10.2708, 0.502004416418592,
10.3342, 0.502003878036986,
10.3976, 0.502003402563419,
10.461, 0.502002982998773,
10.5244, 0.502002613078673,
10.5878, 0.502002287201675,
10.6512, 0.50200200036386,
10.7146, 0.502001748099319,
10.778, 0.50200152642606,
10.8414, 0.502001331796915,
10.9048, 0.502001161055023,
10.9682, 0.502001011393511,
11.0316, 0.502000880319028,
11.095, 0.502000765618783,
11.1584, 0.502000665330808,
11.2218, 0.502000577717141,
11.2852, 0.502000501239672,
11.3486, 0.502000434538424,
11.412, 0.502000376412032,
11.4754, 0.502000325800221,
11.5388, 0.502000281768095,
11.6022, 0.50200024349207,
11.6656, 0.502000210247282,
11.729, 0.502000181396342,
11.7924, 0.502000156379285,
11.8558, 0.502000134704619,
11.9192, 0.50200011594134,
11.9826, 0.502000099711835,
12.046, 0.502000085685565,
12.1094, 0.502000073573461,
12.1728, 0.502000063122948,
12.2362, 0.502000054113537,
12.2996, 0.502000046352924,
12.363, 0.502000039673536,
12.4264, 0.502000033929484,
12.4898, 0.502000028993868,
12.5532, 0.502000024756408,
12.6166, 0.50200002112135,
12.68, 0.502000018005628,
12.7434, 0.502000015337248,
12.8068, 0.502000013053867,
12.8702, 0.502000011101546,
12.9336, 0.502000009433662,
12.997, 0.502000008009949,
13.0604, 0.502000006795661,
13.1238, 0.502000005760846,
13.1872, 0.502000004879703,
13.2506, 0.502000004130029,
13.314, 0.502000003492732,
13.3774, 0.502000002951414,
13.4408, 0.502000002491997,
13.5042, 0.50200000210241,
13.5676, 0.502000001772311,
13.631, 0.502000001492846,
13.6944, 0.502000001256443,
13.7578, 0.50200000105663,
13.8212, 0.502000000887883,
13.8846, 0.502000000745488,
13.948, 0.50200000062543,
14.0114, 0.502000000524287,
14.0748, 0.502000000439149,
14.1382, 0.502000000367543,
14.2016, 0.502000000307366,
14.265, 0.502000000256836,
14.3284, 0.502000000214442,
14.3918, 0.502000000178902,
14.4552, 0.502000000149133,
14.5186, 0.502000000124218,
14.582, 0.502000000103383,
14.6454, 0.502000000085974,
14.7088, 0.502000000071439,
14.7722, 0.502000000059314,
14.8356, 0.502000000049207,
14.899, 0.50200000004079,
14.9624, 0.502000000033786,
15.0258, 0.502000000027962,
15.0892, 0.502000000023123,
15.1526, 0.502000000019107,
15.216, 0.502000000015775,
15.2794, 0.502000000013014,
15.3428, 0.502000000010728,
15.4062, 0.502000000008836,
15.4696, 0.502000000007272,
15.533, 0.50200000000598,
15.5964, 0.502000000004914,
15.6598, 0.502000000004034,
15.7232, 0.50200000000331,
15.7866, 0.502000000002713,
15.85, 0.502000000002222,
end;

begin: elements;

joint: 1, clamp, 1, node, node;
	
joint: 2, in line,
   1,
    position, reference, node, null,
    orientation, 
        1, 0., 0., 1.,
        3, 1., 0., 0.,
   2
;

joint: 3, in line,
   1,
    position, reference, node, null,
    orientation, 
        1, 0., 0., 1.,
        3, 1., 0., 0.,
   3
   ,
		friction,
			preload, F,
			modlugre, 2000, 2.8,0.,0.71, "multi", 
			simple
			;

joint: 4, rod,
	2, position, reference, node, null,
	3, position, reference, node, null,
	from nodes,
	linear elastic, k;

joint: 5, linear velocity,
	2, 
	1., 0, 0,
	const, v;

joint: 6, prismatic,
	1, orientation, eye,
	2, orientation, eye;

joint: 7, prismatic,
	1, orientation, eye,
	3, orientation, eye;

body: 2, 3, M, null, diag, 1.,1.,.05;



end: elements;


##############################################################################################################
## Variables to be updated by simple_testsuite.sh --update-reference-test-status
## Warning, do not edit!!!
## @MBDYN_SIMPLE_TESTSUITE_EXIT_STATUS@ = 0
##############################################################################################################
